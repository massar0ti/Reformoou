<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitar Reforma</title>
    <link rel="stylesheet" href="css/contrate.css">
    <link rel="stylesheet" href="css/FONT.css">
</head>
<style>
    .hidden {
    display: none;
}

.options-container {
    position: absolute;
    border: 1px solid #ccc;
    background-color: white;
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
    width: 41%;
}

.options-container div {
    padding: 8px;
    cursor: pointer;
}

.logo_reformoou{
    width: 150px;
    margin-right: 1100px;
    margin-top: 20px;
}

h1{
    margin-top: 50px;
}

</style>
<body>
    <script src="js/header.js"></script>

    <a href="index.html"><img src="imgnovas/Reformoou4.png" alt="" class="logo_reformoou"></a>
    
    <h1 style="font-weight: 300; margin-top: -130px; font-size: 45px; color: #333333;">Solicitar<br> <span style="font-weight: 600; font-size: 1.3em; margin-bottom: -20px;">reforma</span></h1>
    <form action="/solicitar-reforma" method="POST">

        <fieldset id="cpf-fieldset">
            <p>CPF:
                <input type="text" id="cpf" name="cpf" placeholder="Digite seu CPF" maxlength="14">
            </p>
            <input type="hidden" id="userId" name="userId">
        </fieldset>

        <fieldset id="formulario-fieldset" style="display: none;">
            <p>Tipo de Reforma:
                <select id="tipo_reforma" name="tipo_reforma" onchange="mostrarOpcoesReforma()">
                    <option value="">Selecione</option>
                    <option value="casa">Casa</option>
                    <option value="apartamento">Apartamento</option>
                    <option value="salao">Salão Comercial</option>
                    <option value="outros">Outros</option>
                </select>
            </p>

            <p>Precisa de:
                <div class="custom-select">
                    <input type="hidden" id="especialidade_id" name="especialidade_id">
                    <input type="text" id="especialidade" placeholder="Digite para filtrar...">
                    <div id="especialidade_lista" class="options-container" style="display: none;">
                        <!-- Opcional: você pode adicionar as opções via servidor ou dinamicamente -->
                        <div value="1">Eletricista</div>
                        <div value="2">Encanador</div>
                        <div value="3">Pintor</div>
                        <div value="4">Pedreiro</div>
                        <div value="5">Carpinteiro</div>
                        <div value="6">Azulejista</div>
                        <div value="7">Gesseiro</div>
                        <div value="8">Serralheiro</div>
                        <div value="9">Marceneiro</div>
                        <div value="10">Arquiteto</div>
                        <div value="11">Engenheiro Civil</div>
                        <div value="12">Vidraceiro</div>
                        <div value="13">Jardineiro</div>
                        <div value="14">Paisagista</div>
                        <div value="15">Instalador de Drywall</div>
                        <div value="16">Reparador de Telhados</div>
                        <div value="17">Montador de Móveis</div>
                        <div value="18">Instalador de Ar Condicionado</div>
                        <div value="19">Consultor de Interiores</div>
                        <div value="20">Decorador</div>
                    </div>
                </div>
            </p>

            <div id="detalhes_reforma" class="detalhes-reforma" style="display: none;">
                <p>Ambiente:
                    <div class="container">
                        <input type="text" id="input" placeholder="Digite para filtrar..." autocomplete="off" />
                        <ul id="options-list" class="options-list"></ul>
                        <ul id="selected-options-list" class="selected-options-list"></ul>
                    </div>
                </p>
                <input type="hidden" id="ambientes-selecionados" name="ambiente">
                <div id="ambientes_extras" style="display: none;">
                    <p>Selecione os ambientes:</p>
                    <label><input type="checkbox" name="ambiente_extra" value="banheiro"> Banheiro</label><br>
                    <label><input type="checkbox" name="ambiente_extra" value="cozinha"> Cozinha</label><br>
                    <label><input type="checkbox" name="ambiente_extra" value="corredor"> Corredor</label><br>
                    <label><input type="checkbox" name="ambiente_extra" value="escritorio"> Escritório</label><br>
                    <label><input type="checkbox" name="ambiente_extra" value="lavanderia"> Lavanderia</label><br>
                    <label><input type="checkbox" name="ambiente_extra" value="sala_estar"> Sala de Estar</label><br>
                    <label><input type="checkbox" name="ambiente_extra" value="sala_jantar"> Sala de Jantar</label><br>
                    <label><input type="checkbox" name="ambiente_extra" value="quarto"> Quarto</label><br>
                    <div id="ambiente_personalizado_checkbox" style="display: none;">
                        <p>
                            <input type="checkbox" id="checkbox_outro" name="checkbox_outro">
                            <label for="checkbox_outro">Descreva um ambiente personalizado:</label>
                        </p>
                        <div id="campo_personalizado" style="display: none;">
                            <input type="text" name="ambiente_personalizado" placeholder="Descreva o ambiente">
                        </div>
                    </div>
                </div>

                <div id="ambiente_personalizado_text" style="display: none;">
                    <p>
                        <input type="text" name="ambiente_personalizado" placeholder="Descreva o ambiente">
                    </p>
                </div>

                <p>Área a ser reformada (em m²):
                    <input type="number" name="area_reforma" placeholder="Informe a área">
                </p>

                <div id="salão_comercial" style="display: none;">
                    <h3>Detalhes para Salão Comercial</h3>
                    <p>Tipo de atividade no salão:
                        <input type="text" name="atividade_salao" placeholder="Informe o tipo de atividade">
                    </p>
                </div>
            </div>

            <div id="descricao" class="descricao" style="display: none;">
                <p>Explique o serviço:
                    <textarea name="descricao" id="descricao" rows="4" placeholder="Descreva o que deseja fazer"></textarea>
                </p>
            </div>

            <div id="outros-container" class="outros-container" style="display: none;">
                <label for="descricao_reforma">Explique o que deseja fazer:</label>
                <textarea id="descricao_reforma" name="descricao_reforma" rows="4" placeholder="Descreva o que deseja fazer na reforma..."></textarea>
            </div>

            <div id="proxima_etapa" style="display: none;">
                <input type="button" class="btn-solicitar" onclick="mostrarSegundaParte()" value="Próxima etapa">
            </div>
        </fieldset>

        <fieldset id="segunda_parte" style="display: none;">
            <h2>Detalhes Adicionais</h2>
            <p>Para quando você precisa dessa reforma?
                <select id="prioridade" name="prioridade">
                    <option value="">Selecione</option>
                    <option value="1">O quanto antes</option>
                    <option value="2">Próxima semana</option>
                    <option value="3">Próximo mês</option>
                    <option value="4">Entre 2 e 4 meses</option>
                    <option value="5">5 meses ou mais</option>
                    <option value="6">Apenas orçamento</option>
                </select>
            </p>
            <br>
            <label for="cep">Digite o CEP do local da reforma:</label>
            <input type="text" id="cep" name="cep" maxlength="9" placeholder="12345-678">
            <br><br>        
            <label for="rua">Rua:</label>
            <input type="text" id="rua" name="rua" readonly>
            <br><br>
            <label for="numero">Número:</label>
            <input type="text" name="numero">
            <br><br>
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro" readonly>
            <br><br>
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" readonly>
            <br><br>
            <label for="estado">Estado:</label>
            <input type="text" id="estado" name="estado" readonly>
            <br><br>
            <button class="btn-solicitar">Enviar</button>
        </fieldset>
    </form>
    <script>
        
        function mostrarOpcoesReforma() {
        const tipoReforma = document.getElementById('tipo_reforma').value;
        const detalhesReforma = document.getElementById('detalhes_reforma');
        const outrosContainer = document.getElementById('outros-container');
        const proximaEtapa = document.getElementById('proxima_etapa');
        const salaoComercial = document.getElementById('salão_comercial');
        const descricao = document.getElementById('descricao');
        
        detalhesReforma.style.display = 'none';
        outrosContainer.style.display = 'none';
        proximaEtapa.style.display = 'none';
        salaoComercial.style.display = 'none';
        descricao.style.display = 'none';

        if (tipoReforma === 'casa' || tipoReforma === 'apartamento') {
            detalhesReforma.style.display = 'block';
            descricao.style.display = 'block';
        } else if (tipoReforma === 'salao') {
            detalhesReforma.style.display = 'block';
            salaoComercial.style.display = 'block';
            descricao.style.display = 'block';
        } else if (tipoReforma === 'outros') {
            outrosContainer.style.display = 'block';
        }

        if (tipoReforma) {
            proximaEtapa.style.display = 'block';
        }
        }

        function mostrarAmbientesExtras() {
        const ambiente = document.getElementById('ambiente').value;
        const ambientesExtras = document.getElementById('ambientes_extras');
        const ambientePersonalizadoText = document.getElementById('ambiente_personalizado_text');
        const ambientePersonalizadoCheckbox = document.getElementById('ambiente_personalizado_checkbox');
        
        if (ambiente === 'mais_de_um') {
            ambientesExtras.style.display = 'block';
            ambientePersonalizadoText.style.display = 'none';
            ambientePersonalizadoCheckbox.style.display = 'none';
        } else if (ambiente === 'outros') {
            ambientesExtras.style.display = 'none';
            ambientePersonalizadoText.style.display = 'block';
            ambientePersonalizadoCheckbox.style.display = 'none';
        } else {
            ambientesExtras.style.display = 'none';
            ambientePersonalizadoText.style.display = 'none';
            ambientePersonalizadoCheckbox.style.display = 'none';
        }
        }

        function mostrarCampoPersonalizado() {
        const checkbox = document.getElementById('checkbox_outro');
        const campoPersonalizado = document.getElementById('campo_personalizado');
        campoPersonalizado.style.display = checkbox.checked ? 'block' : 'none';
        }


        function mostrarSegundaParte() {
        document.getElementById('segunda_parte').style.display = 'block';
        }

        function formatCEP(value) {
        return value
            .replace(/\D/g, '') 
            .replace(/^(\d{5})(\d)/, '$1-$2') 
            .slice(0, 9);
        }

        async function fetchAddress(cep) {
        if (cep.length === 9) {
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            if (response.ok) {
            const address = await response.json();
            if (!address.erro) {
                document.getElementById('rua').value = address.logradouro;
                document.getElementById('bairro').value = address.bairro;
                document.getElementById('cidade').value = address.localidade;
                document.getElementById('estado').value = address.uf;
            } else {
                alert('CEP não encontrado.');
            }
            } else {
            alert('Erro ao buscar o CEP.');
            }
        }
        }

        document.addEventListener('DOMContentLoaded', () => {
        const cepInput = document.getElementById('cep');
        
        cepInput.addEventListener('input', (event) => {
            const formattedCEP = formatCEP(event.target.value);
            event.target.value = formattedCEP;

            if (formattedCEP.length === 9) {
            fetchAddress(formattedCEP);
            }
        });

        // Adicionar evento ao checkbox para ambiente personalizado
        document.getElementById('checkbox_outro').addEventListener('change', mostrarCampoPersonalizado);
        });
        function formatCPF(value) {
            return value
        .replace(/\D/g, '') // Remove tudo o que não é dígito
        .replace(/^(\d{3})(\d)/, '$1.$2') // Adiciona o ponto após os 3 primeiros dígitos
        .replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3') // Adiciona o ponto após os 3 próximos dígitos
        .replace(/\.(\d{3})(\d)/, '.$1-$2') // Adiciona o hífen após os 3 últimos dígitos
        .slice(0, 14); // Garante que o comprimento máximo seja 14 caracteres (formato completo do CPF)
}

async function verificarCPF(cpf) {
    if (cpf.length === 14) {
        try {
            const response = await fetch(`/verificar-cpf?cpf=${cpf}`);
            if (response.ok) {
                const result = await response.json();
                if (result.cadastrado) {
                    const userId = result.id;
                    document.getElementById('userId').value = userId; // Armazena o userId no campo oculto
                    console.log('UserID armazenado:', userId);

                    document.getElementById('cpf-fieldset').style.display = 'none';
                    document.getElementById('formulario-fieldset').style.display = 'block';
                } else {
                    localStorage.setItem('redirectAfterCadastro', window.location.href);
                    window.location.href = '/cadastra_cliente_reforma.html';
                }
            } else {
                alert('Erro ao verificar CPF.');
            }
        } catch (error) {
            console.error('Erro na verificação do CPF:', error);
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const cpfInput = document.getElementById('cpf');
    
    cpfInput.addEventListener('input', (event) => {
        const formattedCPF = formatCPF(event.target.value);
        event.target.value = formattedCPF;

        if (formattedCPF.length === 14) {
            verificarCPF(formattedCPF);
        }
    });
    cpfInput.addEventListener('blur', () => {
        const formattedCPF = formatCPF(cpfInput.value);
        cpfInput.value = formattedCPF;
        verificarCPF(formattedCPF);
    });
});

    document.addEventListener('DOMContentLoaded', () => {
        const cpfInput = document.getElementById('cpf');
        
        cpfInput.addEventListener('input', (event) => {
            const formattedCPF = formatCPF(event.target.value);
            event.target.value = formattedCPF;

            if (formattedCPF.length === 14) {
                verificarCPF(formattedCPF);
            }
        });
    });
    document.addEventListener('DOMContentLoaded', () => {
        const cpfInput = document.getElementById('cpf');
        
        cpfInput.addEventListener('blur', () => {
            const formattedCPF = formatCPF(cpfInput.value);
            cpfInput.value = formattedCPF;
            verificarCPF(formattedCPF);
        });
    });   
    
    const input = document.getElementById('input');
const optionsList = document.getElementById('options-list');
const selectedOptionsList = document.getElementById('selected-options-list');
const selectedOptions = []; // Array para armazenar as opções selecionadas
const ambientesSelecionadosInput = document.getElementById('ambientes-selecionados'); // Campo escondido

const originalOptions = [
  { value: '', text: 'Selecione' },
  { value: 'banheiro', text: 'Banheiro' },
  { value: 'cozinha', text: 'Cozinha' },
  { value: 'corredor', text: 'Corredor' },
  { value: 'escritorio', text: 'Escritório' },
  { value: 'lavanderia', text: 'Lavanderia' },
  { value: 'sala_estar', text: 'Sala de estar' },
  { value: 'sala_jantar', text: 'Sala de jantar' },
  { value: 'quarto', text: 'Quarto' },
  { value: 'outros', text: 'Outros' }
];

// Função para atualizar a lista de opções
function updateOptions(filter = '') {
  const filteredOptions = originalOptions.filter(option =>
    option.text.toLowerCase().includes(filter.toLowerCase())
  );

  // Limpa as opções atuais
  optionsList.innerHTML = '';

  // Adiciona as opções filtradas
  filteredOptions.forEach(option => {
    const li = document.createElement('li');
    li.textContent = option.text;
    li.dataset.value = option.value;
    li.addEventListener('click', function () {
      // Adiciona a opção selecionada ao array se ainda não estiver selecionada
      if (!selectedOptions.some(o => o.value === option.value)) {
        selectedOptions.push(option);
        updateSelectedOptions(); // Atualiza a lista de selecionados
        updateAmbientesSelecionados(); // Atualiza o campo escondido
      }
      optionsList.style.display = 'none'; // Esconde a lista de opções
    });
    optionsList.appendChild(li);
  });

  // Exibe ou oculta a lista de opções com base no filtro
  optionsList.style.display = filteredOptions.length ? 'block' : 'none';
}

// Função para atualizar a exibição das opções selecionadas
function updateSelectedOptions() {
  selectedOptionsList.innerHTML = ''; // Limpa a lista
  selectedOptions.forEach(option => {
    const li = document.createElement('li');
    li.textContent = option.text;
    li.dataset.value = option.value;
    
    // Adiciona um botão de remoção para cada opção selecionada
    const removeBtn = document.createElement('button');
    removeBtn.textContent = '×'; // Simbolo de remoção
    removeBtn.addEventListener('click', function () {
      // Remove a opção do array e atualiza a lista de selecionados
      const index = selectedOptions.findIndex(o => o.value === option.value);
      if (index > -1) {
        selectedOptions.splice(index, 1);
        updateSelectedOptions();
        updateAmbientesSelecionados(); // Atualiza o campo escondido
      }
    });

    li.appendChild(removeBtn);
    selectedOptionsList.appendChild(li);
  });
}

// Função para atualizar o campo escondido com os valores selecionados
function updateAmbientesSelecionados() {
  const selectedValues = selectedOptions.map(option => option.value).join(',');
  ambientesSelecionadosInput.value = selectedValues;
}

// Atualiza as opções ao digitar
input.addEventListener('input', function () {
  updateOptions(input.value);
});

// Mostra todas as opções ao focar no input
input.addEventListener('focus', function () {
  updateOptions();
});

// Esconde a lista de opções ao clicar fora da área da lista
document.addEventListener('click', function (event) {
  if (!event.target.closest('.container')) {
    optionsList.style.display = 'none';
  }
});
   /* FIM */

   document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('especialidade');
    const optionsContainer = document.getElementById('especialidade_lista');
    const hiddenInput = document.getElementById('especialidade_id');

    input.addEventListener('input', function() {
        const filter = input.value.toLowerCase();
        const options = optionsContainer.querySelectorAll('div');
        options.forEach(option => {
            const text = option.textContent.toLowerCase();
            if (text.includes(filter)) {
                option.style.display = 'block';
            } else {
                option.style.display = 'none';
            }
        });
        optionsContainer.style.display = 'block';
    });

    optionsContainer.addEventListener('click', function(event) {
        const selectedOption = event.target;
        if (selectedOption.tagName === 'DIV') {
            input.value = selectedOption.textContent;
            hiddenInput.value = selectedOption.getAttribute('value');
            optionsContainer.style.display = 'none';
        }
    });

    document.addEventListener('click', function(event) {
        if (!input.contains(event.target) && !optionsContainer.contains(event.target)) {
            optionsContainer.style.display = 'none';
        }
    });
});

document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('especialidade');
    const optionsContainer = document.getElementById('especialidade_lista');

    // Mostrar opções ao clicar no campo de entrada
    input.addEventListener('focus', function() {
        optionsContainer.style.display = 'block';
    });

    // Esconder opções ao clicar fora do campo de entrada e da lista de opções
    document.addEventListener('click', function(event) {
        if (!input.contains(event.target) && !optionsContainer.contains(event.target)) {
            optionsContainer.style.display = 'none';
        }
    });

    // Filtrar opções ao digitar
    input.addEventListener('input', function() {
        const filter = input.value.toLowerCase();
        const options = optionsContainer.querySelectorAll('div');
        options.forEach(option => {
            const text = option.textContent.toLowerCase();
            option.style.display = text.includes(filter) ? 'block' : 'none';
        });
    });

    // Selecionar uma opção
    optionsContainer.addEventListener('click', function(event) {
        const selectedOption = event.target;
        if (selectedOption.tagName === 'DIV') {
            input.value = selectedOption.textContent;
            document.getElementById('especialidade_id').value = selectedOption.getAttribute('value');
            optionsContainer.style.display = 'none';
        }
    });
});
    </script>
    </body>
    </html>
